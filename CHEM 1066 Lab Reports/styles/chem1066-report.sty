\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{chem1066-report}[2025/02/15 Shared styling for CHEM 1066 lab reports]

% ==============================
% Page Layout
% ==============================
\RequirePackage[top=1.5cm, bottom=3.5cm, left=2cm, right=2cm]{geometry}
\RequirePackage{fullpage}
\RequirePackage{changepage}
\RequirePackage{needspace}
\RequirePackage{indentfirst}
\RequirePackage[hyphens]{url}
\RequirePackage[hidelinks]{hyperref}
\Urlmuskip=0mu plus 1mu
\urlstyle{same}

% ==============================
% Fonts, Spacing, and Formatting
% ==============================
\RequirePackage{setspace}
\setstretch{1.25}
\setlength{\parindent}{2em}
\setlength{\parskip}{0.4em}
\RequirePackage{verbatim}

\RequirePackage{titlesec}
\titlespacing*{\section}{0pt}{0.6em}{0.4em}
\titlespacing*{\subsection}{0pt}{0.4em}{0.3em}

% ==============================
% Mathematics
% ==============================
\RequirePackage{amsmath, amsthm, amsfonts, amssymb, amscd}

% ==============================
% Figures, Captions, and Colors
% ==============================
\RequirePackage{graphicx}
\RequirePackage[labelfont=bf]{caption}
\RequirePackage{xcolor}
\RequirePackage{xparse}

% Palette infrastructure: semantic color names with configurable hex values.
\makeatletter
\newcommand{\ChemReportRedefineColor}[3]{%
    \expandafter\let\csname color@#1\endcsname\relax
    \definecolor{#1}{#2}{#3}%
}
\makeatother

\newcommand{\ChemReportPrimaryColor}{ChemReportPrimary}
\newcommand{\ChemReportSecondaryColor}{ChemReportSecondary}
\newcommand{\ChemReportAccentColor}{ChemReportAccent}
\newcommand{\ChemReportNeutralColor}{ChemReportNeutral}
\newcommand{\ChemReportMutedColor}{ChemReportMuted}

% Palette setters (call from preamble to recolor the theme).
% Primary      → Headings, figure strokes, emphasis rules.
% Secondary    → Data accents, callouts, markers.
% Accent       → Critical annotations (e.g., pKa line).
% Neutral      → Title text, body emphasis.
% Muted        → Background panels or soft fills.
\NewDocumentCommand{\SetChemReportPrimaryColor}{m}{%
    \ChemReportRedefineColor{\ChemReportPrimaryColor}{HTML}{#1}%
    \colorlet{azul}{\ChemReportPrimaryColor}%
}
\NewDocumentCommand{\SetChemReportSecondaryColor}{m}{%
    \ChemReportRedefineColor{\ChemReportSecondaryColor}{HTML}{#1}%
    \colorlet{utorange}{\ChemReportSecondaryColor}%
}
\NewDocumentCommand{\SetChemReportAccentColor}{m}{%
    \ChemReportRedefineColor{\ChemReportAccentColor}{HTML}{#1}%
    \colorlet{cornellred}{\ChemReportAccentColor}%
}
\NewDocumentCommand{\SetChemReportNeutralColor}{m}{%
    \ChemReportRedefineColor{\ChemReportNeutralColor}{HTML}{#1}%
    \colorlet{night}{\ChemReportNeutralColor}%
}
\NewDocumentCommand{\SetChemReportMutedColor}{m}{%
    \ChemReportRedefineColor{\ChemReportMutedColor}{HTML}{#1}%
    \colorlet{whitesmoke}{\ChemReportMutedColor}%
}

\newcommand{\ChemReportSetPalette}[5]{%
    \SetChemReportPrimaryColor{#1}%
    \SetChemReportSecondaryColor{#2}%
    \SetChemReportAccentColor{#3}%
    \SetChemReportNeutralColor{#4}%
    \SetChemReportMutedColor{#5}%
}

% Convenience palettes for quick swapping.
\NewDocumentCommand{\ChemReportUsePaletteDefault}{}{%
    \ChemReportSetPalette{016FB9}{FF8811}{BA1B1D}{171614}{F7F4F3}%
}
\NewDocumentCommand{\ChemReportUsePaletteCoolTwilight}{}{%
    \ChemReportSetPalette{335C81}{FCA311}{E24636}{1F1F24}{F1F5F9}%
}
\NewDocumentCommand{\ChemReportUsePaletteForestGold}{}{%
    \ChemReportSetPalette{2C6E49}{F0A202}{D62828}{1A1A1A}{F5F1E3}%
}
\NewDocumentCommand{\ChemReportUsePaletteSolarPastel}{}{%
    \ChemReportSetPalette{1E3D59}{F5CB5C}{E36BAE}{F2EFEA}{FAFAF5}%
}
\NewDocumentCommand{\ChemReportUsePaletteMidnightNeon}{}{%
    \ChemReportSetPalette{0F172A}{38BDF8}{A855F7}{E2E8F0}{1F2937}%
}
\NewDocumentCommand{\ChemReportUsePaletteVintageRose}{}{%
    \ChemReportSetPalette{7A3E48}{D6A184}{F2B8A0}{2F2F2F}{F7F2ED}%
}

% Apply the default palette at package load; user code can override afterward.
\ChemReportUsePaletteDefault

% ==============================
% TikZ / PGFPlots
% ==============================
\RequirePackage{tikz}
\RequirePackage{pgfplots}
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{intersections}
\pgfplotsset{compat=1.18}

% ==============================
% Miscellaneous
% ==============================
\RequirePackage{fancyhdr}
\RequirePackage[superscript]{cite}
\setlength{\headheight}{15pt}
\headsep 2.5em

% Utility macros
\newcommand{\degree}{\ensuremath{^\circ}}

% ==============================
% Report Metadata Helpers
% ==============================
\newcommand{\ChemReportCourse}{CHEM 1066}
\newcommand{\ChemReportHeader}{Lab Report}
\newcommand{\ChemReportAuthor}{Author}
\newcommand{\ChemReportInstitution}{University of Minnesota -- Twin Cities}
\newcommand{\ChemReportSemester}{Fall 2025}
\newcommand{\ChemReportPartners}{[Lab Partners]}
\newcommand{\ChemReportCoverTitle}{Type Your Title Here:}
\newcommand{\ChemReportCoverSubtitle}{Concise and Informative Subtitle}
\newcommand{\ChemReportPreparedOn}{\today}

% Metadata setters (call these from your report preamble)
% \SetChemReportCourse{CHEM 1066}        → Updates the left header tag
% \SetChemReportHeader{Lab Report 1}     → Updates header center and cover label
% \SetChemReportAuthor{Your Name}        → Updates header right + cover author line
% \SetChemReportInstitution{University}  → Updates cover institution line
% \SetChemReportSemester{Fall 2025}      → Updates cover semester line
% \SetChemReportPartners{Partner List}   → Updates partner line on cover
% \SetChemReportCoverTitle{Title Text}   → Main cover title (supports long text)
% \SetChemReportCoverSubtitle{Subtitle}  → Subtitle line beneath title
% \SetChemReportPreparedOn{Date string}  → Footer timestamp on cover

\NewDocumentCommand{\SetChemReportCourse}{m}{\renewcommand{\ChemReportCourse}{#1}}
\NewDocumentCommand{\SetChemReportHeader}{m}{\renewcommand{\ChemReportHeader}{#1}}
\NewDocumentCommand{\SetChemReportAuthor}{m}{\renewcommand{\ChemReportAuthor}{#1}}
\NewDocumentCommand{\SetChemReportInstitution}{m}{\renewcommand{\ChemReportInstitution}{#1}}
\NewDocumentCommand{\SetChemReportSemester}{m}{\renewcommand{\ChemReportSemester}{#1}}
\NewDocumentCommand{\SetChemReportPartners}{m}{\renewcommand{\ChemReportPartners}{#1}}
\NewDocumentCommand{\SetChemReportCoverTitle}{m}{\renewcommand{\ChemReportCoverTitle}{#1}}
\NewDocumentCommand{\SetChemReportCoverSubtitle}{m}{\renewcommand{\ChemReportCoverSubtitle}{#1}}
\NewDocumentCommand{\SetChemReportPreparedOn}{m}{\renewcommand{\ChemReportPreparedOn}{#1}}

\fancypagestyle{chemreport}{
    \fancyhf{}
    \fancyhead[L]{\ChemReportCourse}
    \fancyhead[C]{\bfseries\Large \ChemReportHeader}
    \fancyhead[R]{\bfseries Author: \ChemReportAuthor}
    \fancyfoot[R]{\small\thepage}
}
\pagestyle{chemreport}
\fancypagestyle{plain}{\fancyhf{}\fancyhead[L]{\ChemReportCourse}\fancyhead[C]{\bfseries\Large \ChemReportHeader}\fancyhead[R]{\bfseries Author: \ChemReportAuthor}\fancyfoot[R]{\small\thepage}}

% ==============================
% Shared Cover Page
% ==============================
\newcommand{\MakeChemReportCoverPage}{%
    \thispagestyle{empty}%
    \begin{center}
        \vspace*{3.5cm}%
        \begin{minipage}{0.78\textwidth}
            \centering
            {\sffamily\footnotesize\textcolor{\ChemReportPrimaryColor!80!black}{\MakeUppercase{\ChemReportHeader}}}\\[1em]
            {\sffamily\bfseries\fontsize{28}{34}\selectfont\textcolor{\ChemReportNeutralColor}{\ChemReportCoverTitle}}\\[0.9em]
            {\color{\ChemReportPrimaryColor!60!black}\rule{0.38\textwidth}{0.8pt}}\\[0.9em]
            {\sffamily\Large\textcolor{\ChemReportNeutralColor!80}{\ChemReportCoverSubtitle}}
        \end{minipage}\\[2.4cm]
        \rule{0.6\textwidth}{0.6pt}\\[1.2cm]
        {\large \textbf{\ChemReportAuthor}}\\[0.3cm]
        {\normalsize \ChemReportPartners}\\[1cm]
        {\large \ChemReportCourse}\\[0.3cm]
        {\normalsize \ChemReportInstitution}\\[0.3cm]
        {\normalsize \textcolor{\ChemReportNeutralColor!55!white}{\ChemReportSemester}}\\[1.2cm]
        \rule{0.3\textwidth}{0.4pt}\\[0.5cm]
        {\small \textcolor{\ChemReportNeutralColor!45!white}{Prepared on \ChemReportPreparedOn}}
    \end{center}%
    \newpage%
    \setcounter{page}{2}%
}
