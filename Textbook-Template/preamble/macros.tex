% Chapter heading macro with counter resets
\setcounter{chapter}{0}

\newcommand{\ChapterHeading}[2]{%
  \ifnum\value{chapter}>0
    \clearpage
  \fi
  \refstepcounter{chapter}%
  \setcounter{equation}{0}%
  \setcounter{textexample}{0}%
  \setcounter{theorem}{0}%
  \setcounter{definition}{0}%
  \setcounter{marginfigure}{0}%
  \vspace*{1em}%
  \begin{tikzpicture}[remember picture,overlay]
    \fill[Accent] (current page.west|-{0,0}) rectangle ++(\paperwidth,1.1cm);
  \end{tikzpicture}%
  \vspace{0.4cm}%
  \noindent
  \begin{minipage}{\textwidth}
    \raggedright
    \begin{tikzpicture}[baseline=(chapnum.base)]
      \node[fill=black,text=white,font=\fonttitle,
            inner xsep=10pt,inner ysep=6pt,anchor=base west] (chapnum) {CHAPTER~\thechapter};
      \node[font=\fonttitle,text=Primary,
            anchor=base west,right=0.8em of chapnum.base east,
            align=left,text width=\dimexpr\textwidth-4cm\relax] (title) {#2};
    \end{tikzpicture}
  \end{minipage}
  \markboth{#2}{#2}%
  \vspace{0.4em}\par\noindent
}

% Contents heading that mirrors the chapter styling without advancing counters
\newcommand{\ContentsHeading}[2][]{%
  \def\contentsheadingdisplay{#2}%
  \def\contentsheadingmark{#2}%
  \if\relax\detokenize{#1}\relax\else
    \def\contentsheadingmark{#1}%
  \fi
  \vspace*{1em}%
  \begin{tikzpicture}[remember picture,overlay]
    \fill[Accent] (current page.west|-{0,0}) rectangle ++(\paperwidth,1.1cm);
  \end{tikzpicture}%
  \vspace{0.4cm}%
  \noindent
  \begin{minipage}{\textwidth}
    \raggedright
    \begin{tikzpicture}[baseline=(chapnum.base)]
      \node[fill=black,text=white,font=\fonttitle,
            inner xsep=10pt,inner ysep=6pt,anchor=base west] (chapnum) {CONTENTS};
      \node[font=\fonttitle,text=Primary,
            anchor=base west,right=0.8em of chapnum.base east,
            align=left,text width=\dimexpr\textwidth-4cm\relax] (title) {\contentsheadingdisplay};
    \end{tikzpicture}
  \end{minipage}
  \markboth{\contentsheadingmark}{\contentsheadingmark}%
  \vspace{2em}\par\noindent
}

% Helper to transition from front matter to main matter without forcing blank pages
\newcommand{\StartMainMatter}{%
  \clearpage
  \mainmatter
}

% Section title bar with leading number block
\newcommand{\SectionBar}[2]{%
  \Needspace*{4\baselineskip}%
  \vspace{0.4em}%
  \noindent
  \begin{tikzpicture}[baseline=(num.base)]
    \node[fill=black,text=white,font=\fontheader\large,
          inner xsep=8pt,inner ysep=4pt,anchor=base west] (num) {#1};
    \draw[RuleGray,line width=1pt]
      (num.south west)--($(num.south west)+(\textwidth,0)$);
    \node[font=\fontheader\large,text=Primary,
          anchor=base west,right=0.7em of num.base east] (txt) {#2};
  \end{tikzpicture}
  \vspace{0.4em}\par\noindent
}

% Utility macros used throughout the notes
\newcommand{\keyword}[1]{\textbf{#1}}
\newcommand{\bluearrow}{\textcolor{Primary}{\large\(\blacktriangleright\)}\;}
